SMTable=jQuery.fn.extend({SmartTable:function(u){$.extend(SMTable,{redraw:function(){v(u,$(this))},destroy:function(){$(this).empty()}});var o=function(e,n){var i=e.find(".headarea > .lengthinputcont > .lengthinput"),a=e.find(".headarea > .orderinputcont > .orderinput"),l=e.find(".headarea > .ordertypeinputcont > .ordertypeinput"),t=e.find(".headarea > .viewtypecont > .viewtypeinput"),d=e.find(".headarea > .searchtablecont > .searchtable"),r=e.find(".pagination");i.off("change").on("change",function(){r.empty();var a=n;return a.length=i.val(),a.draw=1,a.start=0,v(a,e),!1}),a.off("change").on("change",function(){var a=$(this).val();r.empty();var t=n;return t.length=i.val(),t.draw=1,t.start=0,t.order.column=a,t.order.dir=l.val(),v(t,e),!1}),l.off("change").on("change",function(){r.empty();var a=n;return a.length=parseInt(i.val()),a.draw=1,a.start=0,a.order.dir=$(this).val(),v(a,e),!1}),t.off("change").on("change",function(){e.find("table").find("tbody").empty(),r.empty();var a=n;return a.length=parseInt(i.val()),a.draw=1,a.start=0,a.dataview=$(this).val(),e.empty(),c(e,n),v(n,e,o(e,n)),!1});var s=!0;d.off("input").on("input",function(a){var t=n;return t.length=parseInt(i.val()),t.draw=1,t.start=0,t.search.value=$(this).val(),s&&clearTimeout(s),s=setTimeout(function(){r.empty(),v(t,e)},500),!1}),null!=n.onInitComplete&&n.onInitComplete()};function v(f,p,a){p.find(".tablefooterarea > .statuslbl").css("visibility","visible");var h=f.columns,t=f.ajax.url,e=f.ajax.method,n=Object.assign({},f);n.onInitComplete=null,n.onDrawUpdated=null,$.ajax({url:t,method:e,data:n,success:function(a){var t=JSON.parse(a),e=t.recordsFiltered,n=t.recordsDraw,l=f.dataview,d=parseInt(p.find(".headarea > .lengthinputcont > .lengthinput").val()),r=0;if(r=e%d==0?parseInt(e/d):parseInt(e/d)+1,"table"==l){var s="<tbody >",o=t.data;$.each(o,function(a,e){s+="<tr>",$.each(h,function(a,t){f.hiddenOnTable||(s+="<td>"+e[t.data]+"</td>")}),s+="</tr>"}),s+="</tbody>",0<p.find("table").find("tbody").length?p.find("table").find("tbody").fadeOut("fast",function(){p.find("table").find("tbody").replaceWith(s),p.find("table").find("tbody").hide(),p.find("table").find("tbody").fadeIn("fast",function(){p.find(".tablefooterarea > .statuslbl").css("visibility","hidden")})}):(p.find("table").append(s),p.find("table").find("tbody").hide(),p.find("table").find("tbody").fadeIn("fast",function(){p.find(".tablefooterarea > .statuslbl").css("visibility","hidden")}))}else if("grid"==l){s="",o=t.data;if($.each(o,function(a,e){s+="<li>",$.each(h,function(a,t){t.hiddenOnGrid||(f.ongridview.removeheaders?s+="<div>"+e[t.data]+"</div>":s+="<div>"+t.name+": "+e[t.data]+"</div>")}),s+="</li>"}),0<p.find(".gridcontainer").find("ul.table").children().length){var c='<div class="gridcontainer"><ul class="table '+(p.attr("class")+"_smtable")+'" type="text">'+s+"</ul></div>";p.find(".gridcontainer").fadeOut("fast",function(){p.find(".gridcontainer").replaceWith(c),p.find(".gridcontainer").hide(),p.find(".gridcontainer").fadeIn("fast",function(){p.find(".tablefooterarea > .statuslbl").css("visibility","hidden")})})}else p.find("ul.table").append(s),p.find(".gridcontainer").hide(),p.find(".gridcontainer").fadeIn("fast",function(){p.find(".tablefooterarea > .statuslbl").css("visibility","hidden")})}!function(a,t,l){1==a?l.find(".pagination").append('<li class="page-item prev disabled"><a class="page-link prev" href="#">Previous</a></li>'):l.find(".pagination").append('<li class="page-item prev"><a class="page-link prev" href="#">Previous</a></li>');for(i=0;i<t;i++)i+1==a?l.find(".pagination").append('<li class="page-item active"><a class="page-link" href="#">'+(i+1)+"</a></li>"):l.find(".pagination").append('<li class="page-item"><a class="page-link" href="#">'+(i+1)+"</a></li>");a==t?l.find(".pagination").append('<li class="page-item next disabled"><a class="page-link next" href="#">Next</a></li>'):l.find(".pagination").append('<li class="page-item next"><a class="page-link next" href="#">Next</a></li>');l.find(".pagination").find(".page-item").find(".page-link").off("click").on("click",function(){var a=parseInt(l.find(".tablefooterarea > nav > ul.pagination > .page-item.active > a").html()),t=parseInt($(this).html());if(a!=t){if(l.find(".pagination").empty(),$(this).hasClass("prev"))var e=a-1;else if($(this).hasClass("next")){var e=a+1;console.log(e)}else var e=$(this).html();var n=(e-1)*l.find(".headarea > .lengthinputcont > .lengthinput").val(),i=u;return i.draw=e,i.start=n,i.length=l.find(".headarea > .lengthinputcont > .lengthinput").val(),v(i,l),!1}})}(f.draw,r,p),p.find(".tablefooterarea > .resultslbl").html("Shows: "+(f.start+1)+" to "+(f.start+n)+". Total: "+e),null!=f.onDrawUpdated&&f.onDrawUpdated()}})}function c(a,t){a.addClass("smarttable");var e=t.lengthinput,n=t.length,i=t.dataview,l=t.columns,d='<div class="headarea">';t.actions.length&&(d+='<label class="lengthinputcont">Length: <select class="form-control lengthinput" type="text">',$.each(e,function(a,t){d+='<option value="'+t+'">'+t+"</option>"}),d+="</select></label>"),t.actions.order&&(d+='<label class="orderinputcont">Order by: <select class="form-control orderinput" type="text">',$.each(l,function(a,t){"true"==t.orderable&&(d+='<option value="'+a+'">'+t.data+"</option>")}),d+="</select></label>",d+='<label class="ordertypeinputcont">Order dir: <select class="form-control ordertypeinput" type="text">',d+='<option value="asc">asc</option>',d+='<option value="desc">desc</option>',d+="</select></label>"),t.actions.view&&(d+='<label class="viewtypecont">View: <select class="form-control viewtypeinput" type="text">',d+='<option value="table">table</option>',d+='<option value="grid">grid</option>',d+="</select></label>"),t.actions.search&&(d+='<label class="searchtablecont"><input class="form-control searchtable" placeholder="Search"  type="text"></label>'),d+="</div>";var r=a.attr("class")+"_smtable";"table"==i?d+='<table class="table '+r+' table-bordered" type="text"></table>':"grid"==i&&(d+='<div class="gridcontainer"><ul class="table '+r+'" type="text"></ul></div>'),d+='<div class="tablefooterarea"><div class="resultslbl">Total:</div><div class="statuslbl"><div class="smtableloader"></div>Loading...</div><nav><ul class="pagination"></ul></nav></div>',a.append(d),a.find(".headarea > .lengthinputcont > .lengthinput").val(n),$(".viewtypeinput").val(t.dataview),"table"==i&&function(a,t){cols=t.columns,ordercol=t.order.column,a.find("thead").append("<tr>");var e="<thead class='thead-light'><tr>";$.each(cols,function(a,t){e+="<th style='width:"+t.width+"'>",e+="<a  data='"+a+"' class='headerlinks'>"+t.name+"</a>",e+="</th>"}),e+="</tr></thead>",0==a.find("table").find("thead").length&&a.find("table").append(e)}(a,t)}return this.each(function(){var a=$(this);u.draw=1,u.start=0,u.search={},u.search.value="",u.search.regex="false",c(a,u),v(u,a,o(a,u))})}});
